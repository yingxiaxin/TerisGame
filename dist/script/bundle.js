!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";var n,r;i.r(e),function(t){t[t.left=0]="left",t[t.right=1]="right",t[t.down=2]="down"}(n||(n={})),function(t){t[t.init=0]="init",t[t.playing=1]="playing",t[t.pause=2]="pause",t[t.over=3]="over"}(r||(r={}));var o={panelSize:{width:14,height:20},nextSize:{width:6,height:6},level:[{score:0,duration:1500},{score:300,duration:1e3},{score:1e3,duration:800},{score:2e3,duration:500},{score:3e3,duration:300}]},s=function(){function t(){}return t.canIMove=function(t,e,i){var n=t.map(function(t){return{x:t.x+e.x,y:t.y+e.y}}),r=n.some(function(t){return t.x<0||t.x>o.panelSize.width-1||t.y<0||t.y>o.panelSize.height-1});return!r&&!(r=n.some(function(t){return i.some(function(e){return e.point.x===t.x&&e.point.y===t.y})}))},t.move=function(e,i,r){if(function(t){if(void 0===t.x)return!1;return!0}(i))return!!t.canIMove(e.shape,i,r)&&(e.centerPoint=i,!0);var o=i,s=void 0;return s=o===n.down?{x:e.centerPoint.x,y:e.centerPoint.y+1}:o===n.left?{x:e.centerPoint.x-1,y:e.centerPoint.y}:{x:e.centerPoint.x+1,y:e.centerPoint.y},t.move(e,s,r)},t.moveDirectly=function(e,i,n){for(;t.move(e,i,n););},t.rotate=function(e,i){var n=e.rotateShape();return!!t.canIMove(n,e.centerPoint,i)&&(e.rotate(),!0)},t.getLineSquares=function(t,e){return t.filter(function(t){return t.point.y===e})},t.deleteSquare=function(t){for(var e=t.map(function(t){return t.point.y}),i=Math.max.apply(Math,e),n=0,r=Math.min.apply(Math,e);r<=i;r++)this.deleteLine(t,r)&&n++;return n},t.deleteLine=function(t,e){var i=this.getLineSquares(t,e);return i.length===o.panelSize.width&&(i.forEach(function(e){e.viewer&&e.viewer.remove();var i=t.indexOf(e);t.splice(i,1)}),t.filter(function(t){return t.point.y<e}).forEach(function(t){t.point={x:t.point.x,y:t.point.y+1}}),!0)},t}();function c(t,e){var i=e-t;return Math.floor(Math.random()*i+t)}var h,u=function(){function t(){this._point={x:0,y:0},this._color="red"}return Object.defineProperty(t.prototype,"point",{get:function(){return this._point},set:function(t){this._point=t,this._viewer&&this._viewer.show()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._viewer&&this._viewer.show()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewer",{get:function(){return this._viewer},set:function(t){t&&(this._viewer=t,this._viewer.show())},enumerable:!0,configurable:!0}),t}(),a=function(){function t(t,e,i){var n=this;this._isClockWise=!0,this._shape=t,this._centerPoint=e,this._color=i;var r=[];this._shape.forEach(function(t){var e=new u;e.color=n._color,e.point={x:n._centerPoint.x+t.x,y:n._centerPoint.y+t.y},r.push(e)}),this._squares=r}return Object.defineProperty(t.prototype,"squares",{get:function(){return this._squares},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"centerPoint",{get:function(){return this._centerPoint},set:function(t){this._centerPoint=t,this.setSquarePoints()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shape",{get:function(){return this._shape},enumerable:!0,configurable:!0}),t.prototype.rotateShape=function(){return this._isClockWise?this._shape.map(function(t){return{x:-t.y,y:t.x}}):this._shape.map(function(t){return{x:t.y,y:-t.x}})},t.prototype.rotate=function(){var t=this.rotateShape();this._shape=t,this.setSquarePoints()},t.prototype.setSquarePoints=function(){var t=this;this._shape.forEach(function(e,i){t._squares[i].point={x:t._centerPoint.x+e.x,y:t._centerPoint.y+e.y}})},t}(),p=(h=function(t,e){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}h(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),f=[function(t){function e(e,i){return t.call(this,[{x:0,y:-1},{x:-1,y:0},{x:0,y:0},{x:1,y:0}],e,i)||this}return p(e,t),e}(a),function(t){function e(e,i){return t.call(this,[{x:-2,y:0},{x:-1,y:0},{x:0,y:0},{x:0,y:-1}],e,i)||this}return p(e,t),e}(a),function(t){function e(e,i){return t.call(this,[{x:2,y:0},{x:1,y:0},{x:0,y:0},{x:0,y:-1}],e,i)||this}return p(e,t),e}(a),function(t){function e(e,i){return t.call(this,[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1}],e,i)||this}return p(e,t),e.prototype.rotate=function(){t.prototype.rotate.call(this),this._isClockWise=!this._isClockWise},e}(a),function(t){function e(e,i){return t.call(this,[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:1,y:1}],e,i)||this}return p(e,t),e.prototype.rotate=function(){t.prototype.rotate.call(this),this._isClockWise=!this._isClockWise},e}(a),function(t){function e(e,i){return t.call(this,[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],e,i)||this}return p(e,t),e.prototype.rotateShape=function(){return this.shape},e}(a),function(t){function e(e,i){return t.call(this,[{x:-1,y:0},{x:0,y:0},{x:1,y:0},{x:2,y:0}],e,i)||this}return p(e,t),e.prototype.rotate=function(){t.prototype.rotate.call(this),this._isClockWise=!this._isClockWise},e}(a)],l=["red","blue","green","orange","purple","white"];function y(t){var e=c(0,f.length),i=f[e];return e=c(0,l.length),new i(t,l[e])}var _=function(){function t(t){this._gameStatus=r.init,this._nextTeris=y({x:2,y:2}),this._duration=o.level[0].duration,this._exists=[],this._score=0,this._viewer=t,this.resetCenterPoint(o.nextSize.width,this._nextTeris),this._viewer.showNext(this._nextTeris),this._viewer.init(this),this._viewer.showScore(this.score)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},set:function(t){var e=this;this._score=t,this._viewer.showScore(this._score);var i=o.level.filter(function(t){return t.score<=e._score}).pop();i.duration!==this._duration&&(this._duration=i.duration,this._timer&&(clearInterval(this._timer),this._timer=void 0,this.autoDrop()))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameStatus",{get:function(){return this._gameStatus},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._exists.forEach(function(t){t.viewer&&t.viewer.remove()}),this._exists=[],this._nextTeris=y({x:0,y:0}),this.resetCenterPoint(o.nextSize.width,this._nextTeris),this._viewer.showNext(this._nextTeris),this._curTeris=void 0,this.score=0},t.prototype.start=function(){this._gameStatus!==r.playing&&(this._gameStatus===r.over&&this.init(),this._gameStatus=r.playing,this._curTeris||this.switchTeris(),this.autoDrop(),this._viewer.onGameStart())},t.prototype.pause=function(){this._gameStatus===r.playing&&(this._gameStatus=r.pause,clearInterval(this._timer),this._timer=void 0,this._viewer.onGamePause())},t.prototype.controlLeft=function(){this._curTeris&&this._gameStatus===r.playing&&s.move(this._curTeris,n.left,this._exists)},t.prototype.controlRight=function(){this._curTeris&&this._gameStatus===r.playing&&s.move(this._curTeris,n.right,this._exists)},t.prototype.controlDown=function(){this._curTeris&&this._gameStatus===r.playing&&(s.moveDirectly(this._curTeris,n.down,this._exists),this.hitBottom())},t.prototype.controlRotate=function(){this._curTeris&&this._gameStatus===r.playing&&s.rotate(this._curTeris,this._exists)},t.prototype.switchTeris=function(){if(this._curTeris=this._nextTeris,this.resetCenterPoint(o.panelSize.width,this._curTeris),this._curTeris.squares.forEach(function(t){t.viewer&&t.viewer.remove()}),!s.canIMove(this._curTeris.shape,this._curTeris.centerPoint,this._exists))return this._gameStatus=r.over,clearInterval(this._timer),this._timer=void 0,void this._viewer.onGameOver();this._nextTeris=y({x:0,y:0}),this.resetCenterPoint(o.nextSize.width,this._nextTeris),this._viewer.switch(this._curTeris),this._viewer.showNext(this._nextTeris)},t.prototype.autoDrop=function(){var t=this;this._timer||this._gameStatus!==r.playing||(this._timer=setInterval(function(){t._curTeris&&(s.move(t._curTeris,n.down,t._exists)||t.hitBottom())},this._duration))},t.prototype.resetCenterPoint=function(t,e){var i=Math.ceil(t/2)-1;for(e.centerPoint={x:i,y:0};e.squares.some(function(t){return t.point.y<0});)e.centerPoint={x:e.centerPoint.x,y:e.centerPoint.y+1}},t.prototype.hitBottom=function(){this._exists=this._exists.concat(this._curTeris.squares);var t=s.deleteSquare(this._exists);this.addScore(t),this.switchTeris()},t.prototype.addScore=function(t){switch(t){case 0:return;case 1:this.score+=10;break;case 2:this.score+=15;break;case 3:this.score+=20;break;case 4:this.score+=25;break;default:this.score+=30}},t}(),x={width:30,height:30},m=function(){function t(t,e){this.isRemove=!1,this.square=t,this.container=e}return t.prototype.show=function(){if(!this.isRemove){if(!this.dom){var t=document.createElement("div");t.style.cssText="position: absolute;\n                                 width: "+x.width+"px;\n                                 height: "+x.height+"px;\n                                 border: 1px solid #ccc;\n                                 box-sizing: border-box;",this.dom=t,this.container.append(this.dom)}this.dom.style.left=this.square.point.x*x.width+"px",this.dom.style.top=this.square.point.y*x.height+"px",this.dom.style.backgroundColor=this.square.color}},t.prototype.remove=function(){this.dom&&!this.isRemove&&(this.container.removeChild(this.dom),this.isRemove=!0)},t}();new _(new(function(){function t(){this.nextDom=document.getElementById("next"),this.panelDom=document.getElementById("panel"),this.scoreDom=document.getElementById("score"),this.msgDom=document.getElementById("msg"),this.msgText=document.getElementById("msgText")}return t.prototype.showNext=function(t){var e=this;t.squares.forEach(function(t){t.viewer=new m(t,e.nextDom)})},t.prototype.switch=function(t){var e=this;t.squares.forEach(function(t){t.viewer.remove(),t.viewer=new m(t,e.panelDom)})},t.prototype.init=function(t){this.panelDom.style.cssText=this.panelDom.style.cssText+"width: "+o.panelSize.width*x.width+"px;\n                                                                     height: "+o.panelSize.height*x.height+"px;",this.nextDom.style.cssText=this.nextDom.style.cssText+"width: "+o.nextSize.width*x.width+"px;\n                                                                   height: "+o.nextSize.height*x.height+"px",document.addEventListener("keydown",function(e){switch(e.keyCode){case 37:t.controlLeft();break;case 38:t.controlRotate();break;case 39:t.controlRight();break;case 40:t.controlDown();break;case 32:t.gameStatus===r.playing?t.pause():t.start()}})},t.prototype.showScore=function(t){this.scoreDom.innerHTML=t.toString()},t.prototype.onGameOver=function(){this.msgDom.style.opacity="1",this.msgText.innerHTML="游戏结束"},t.prototype.onGamePause=function(){this.msgDom.style.opacity="1",this.msgText.innerHTML="游戏暂停"},t.prototype.onGameStart=function(){this.msgDom.style.opacity="0"},t}()))}]);